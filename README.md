# Spring Boot - User && Roles - JWT Security Demo

## About

Spring boot demo for user with roles using JWT and H2.

## Requirements

    - Language: Java
    - Spring Boot: 2.5.x
    - Group: com.nv
    - Artifact: user-authentication-service-spring-boot
    - Dependencies:
    - Spring Web
    - Spring Data JPA
    - H2 Database
    - Spring Security

## Usage

*mvn spring-boot:run*
[Localhost](http://localhost:8080/).

**H2-Console** admin: [H2-Console](http://localhost:8080/spring-boot-jwt-security/h2-console)

## Backend

POST - /sing-up - genetare new token

```
curl --request POST \
--url http://localhost:8080/sign-up \
--header 'Content-Type: application/json' \
--data '{
"name": "John Doe",
"email": "johndoe@example.com",
"password": "Abc123456",
"phones": [
    {
        "number": 1234567890,
        "citycode": 123,
        "contrycode": "+1"
    }
]
}'
```

POST - /login
```
curl --request POST \
  --url http://localhost:8080/login \
  --header 'Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJqb2huZG9lQGV4YW1wbGUuY29tIiwiaWF0IjoxNjIzNTMwOTk0LCJleHAiOjE2MjM1MzE1OTR9.hgopXa3q0o5U6Cc5U5iqX9YdAfKk7AHf2x_qUJ10smU6eJCDKj3u3JiZVylC9EhqfrZV7nMxR1BcRrjJHd8b7A' \
  --header 'Content-Type: application/json' \
  --data '{
    "username": "johndoe@example.com"
}'
```


### Components Diagram
                   +-------------+
                   |   Client    | 
                   +-------------+
                          |
                          |
                   +-------------+
                   |    API      |
                   | Controllers |
                   +-------------+
                   |   Services  | -> Login & User
                   +-------------+                   
                   | Repositories| -> User
                   +-------------+
                          |
                          |
            +-------------+-------------+
            |             |             |
    +-------------+  +-------------+  +-------------+
    |   Database  |  |  JWT Auth   |  |    Logger   |
    +-------------+  +-------------+  +-------------+

    Client: represents the user who interacts with the system through a web or mobile application.
    API: provides the interface for the client to interact with the system. 
    Controllers: receive requests from the client and delegate the execution to the corresponding services. They also handle the responses and send them back to the client.
    Services: implement the business logic of the system. They receive requests from the controllers, perform the necessary operations on the data, and return the results back to the controllers.
    Repositories: datasource access object for entities.
    Database: stores the data used by the system.
    JWT Auth: provides the authentication and authorization mechanism for the system. It generates and validates JWT tokens to ensure that only authorized users can access the API.
    Logger: logs the events and errors generated by the system. It can be used for debugging, monitoring, and auditing purposes.



### Sequence Diagram

    User->Controller: POST /sign-up with user info
    Controller->Service: Create user with user info
    Service->Repository: Save user info to Database
    Repository->Database: Store user info in database
    Service->JWTUtil: Generate token for the user
    JWTUtil->Service: Return token to Service
    Service->Controller: Return user info and token to user
    
    User->Controller: POST /login with user credentials
    Controller->Service: Authenticate user credentials
    Service->Repository: Get user info from Database
    Repository->Database: Retrieve user info from database
    Service->JWTUtil: Generate new token for the user
    JWTUtil->Service: Return new token to Service
    Service->Controller: Return user info and new token to user

### Database configuration

Actually this demo is using an embedded H2 database.

## Author

**Nicolas Valfre**
